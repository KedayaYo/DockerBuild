(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9762e490"],{"0627":function(t,e,i){},"0664":function(t,e,i){"use strict";i("7797")},1227:function(t,e,i){"use strict";i("0627")},"13d5":function(t,e,i){"use strict";var a=i("23e7"),s=i("d58f").left,n=i("a640"),o=i("2d00"),l=i("605d"),c=!l&&o>79&&o<83,r=c||!n("reduce");a({target:"Array",proto:!0,forced:r},{reduce:function(t){var e=arguments.length;return s(this,t,e,e>1?arguments[1]:void 0)}})},"270d":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAWCAYAAADeiIy1AAAAAXNSR0IArs4c6QAAAy1JREFUSEullU9oXHUQx7+zuzF/2AoiHtKYYAnBgyeLQcmh2l4EKQipF8Em+c3vgeghB6s5haZLTlYLPTTQiG9elgYpoVUQxVO0bUpRQQ9GUCQR3LYqemtWXJPdN2U2u8Fs9m1COpcHv9/MfH7z9xFaSBiGnojeAnAIAAHQBnU7SwH4A8A8M08muTPFphKG4QkiutLqIU3u3mfmd5rZJIJEpASgXVVduVz+rKOjQ0ul0g79bDZbKZVKTxHRkgFUtd97/2sjbMswn8/3qWpvHMcZAK8DeBXAEjMf2UtUYRieIaIpVf0BwKlUKvUfgL+dcz+bfRUURdFZVW0MuZxOp58YHR29uxeQ6YjICoD+Bv1PmHmYROQ1AJdql7cAbABYTqVS58fGxlb3CjG9mZmZbFdX10Qcx0NE9BCAZwHY95yB6p30HDN/k+R4dna2O5PJDBPRoKq2E9FPcRx/HATBj0k2+Xz+0Uql8rvBDPSP1ZCZs0kGIjIB4N2E+w+Y2WraVESkAKCXjFoul9u990beIVEUsaqGtYuPAHxRS+8QgPFqoYkuOufeaGYvIrcBPJ7Y3mZk6Wpra6s+QFVf8d5f/b8zETkM4DqArKoe895/1QgTkTsAelqCRGQawCQRTTvnTidE/JKqfm5AZn4hESQiNwAccM4dJqJtK0ZErgF4Po7jgSAIrHWT6hADiJnZZnCbbEVU7zoi6nTO2TbYEhH5HsDTRNTtnPuzBahiO885l2ry2M3UtQJFUfShqnpVfdl7/2lCsR8D8BeAFWYe2FdEYRgeJaIvVfUX7/2TCSBrEJuvM8653L5AZiQiX9uEq+p3qvpmEATf2vnc3Fx/pVKZIqKTANZUtcd7v7Zv0Pz8/MPr6+uLAJ6pObGc28Ks7jQisn/Ri8655YSIt9eoWCx2jI+Pm4OkzrKBtB/bwZrCv0R0IZ1O50ZGRmy7JNltDmy9GZi55UzVvdRSlikUCqu5XK6cBKifi8hvAPoMdM/maLdZ2c1hs/uFhYV0sVi0unUa6G0A75miqi4S0ToRpffjuG6jqko2UKqDAB5R1cvVdIlItUUfxHkL25sbGxvH7wMyzILCUiLBSgAAAABJRU5ErkJggg=="},4484:function(t,e,i){t.exports=i.p+"img/no_point.3a463b08.png"},"5b9e":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"line"},[e("ScreenShot",{ref:"screenShot"}),t.loading?e("div",{staticClass:"shot-loading"},[e("a-spin",{attrs:{size:"large"}}),e("span",[t._v("正在生成缩略图，请稍等~~")])],1):t._e(),e("div",{class:["modal-left",t.shrinkLeft?"modal-shrink":""]},[t._m(0),t.shrinkLeft?e("img",{staticClass:"shrink",attrs:{src:i("b478")},on:{click:function(e){t.shrinkLeft=!t.shrinkLeft}}}):e("img",{staticClass:"shrink",attrs:{src:i("15b8")},on:{click:function(e){t.shrinkLeft=!t.shrinkLeft}}}),e("div",{staticClass:"task-mainer x-scroll"},[e("div",{staticClass:"task-name"},[e("a-input",{model:{value:t.missionName,callback:function(e){t.missionName=e},expression:"missionName"}},[e("img",{attrs:{slot:"suffix",src:i("1e1d"),alt:""},slot:"suffix"})])],1),e("div",{staticClass:"task-address"},[e("img",{attrs:{src:i("5f89"),alt:""}}),e("span",[t._v(t._s(t.address||"位置信息（请在地图上选点）"))])]),e("div",{staticClass:"task-icon-module"},[e("div",{staticClass:"module"},[t._m(1),e("div",{staticClass:"text"},[t._v(" "+t._s(t.pointsNum)+" ")]),e("div",{staticClass:"unit"},[t._v(" 航点数 ")])]),e("div",{staticClass:"module"},[t._m(2),e("div",{staticClass:"text"},[t._v(" "+t._s(t.distance)+" ")]),e("div",{staticClass:"unit"},[t._v(" 飞行里程(km) ")])]),e("div",{staticClass:"module"},[t._m(3),e("div",{staticClass:"text"},[t._v(" "+t._s(t.flyTime)+" ")]),e("div",{staticClass:"unit"},[t._v(" 飞行时间(min) ")])])]),e("div",{staticClass:"tab-c"},[e("div",{staticClass:"tab"},[e("a-tooltip",{attrs:{placement:"bottom"}},[e("template",{slot:"title"},[e("span",[t._v("统一设置所有航点信息，后续可选择单点调整。")])]),e("div",{staticClass:"tab-item",class:{active:"line"===t.settingType},on:{click:function(e){t.settingType="line"}}},[t._v(" 任务设置 ")])],2),e("div",{staticClass:"tab-item",class:{active:"point"===t.settingType},on:{click:function(e){t.settingType="point"}}},[t._v(" 航点设置 ")])],1)]),0===t.pointsList.length?[t._m(4)]:[e("div",{directives:[{name:"show",rawName:"v-show",value:"line"===t.settingType,expression:"settingType === 'line'"}],staticClass:"setting-c"},[e("div",{staticClass:"num-c"},[e("PlanSlider",{attrs:{value:t.cruiseSpeed,title:"飞行速度",unit:"m/s",icon:i("c091"),min:1,max:15,step:1},on:{change:function(e){return t.sliderChangeEvent(e,"cruiseSpeed")}}}),e("PlanSlider",{attrs:{value:t.cruiseAltitude,title:"飞行高度",unit:"m",icon:i("8e1c"),min:20,max:500,step:1},on:{change:function(e){return t.sliderChangeEvent(e,"cruiseAltitude")}}}),e("PlanSlider",{attrs:{value:t.cruiseGimbalPitch,title:"云台俯仰角度",unit:"°",icon:i("5dec"),min:-90,max:0,step:1},on:{change:function(e){return t.sliderChangeEvent(e,"cruiseGimbalPitch")}}}),e("div",{staticClass:"task-line-module take-off"},[t._m(5),e("a-switch",{model:{value:t.isGPhoto,callback:function(e){t.isGPhoto=e},expression:"isGPhoto"}})],1),e("div",{staticClass:"task-line-module take-off"},[t._m(6),e("a-switch",{model:{value:t.globalUseStraightLine,callback:function(e){t.globalUseStraightLine=e},expression:"globalUseStraightLine"}})],1),e("div",{staticClass:"task-line-module take-off"},[t._m(7),e("a-select",{staticStyle:{width:"54%"},attrs:{"dropdown-class-name":"black-theme"},model:{value:t.globalWaypointTurnMode,callback:function(e){t.globalWaypointTurnMode=e},expression:"globalWaypointTurnMode"}},[e("template",{slot:"suffixIcon"},[e("a-icon",{attrs:{type:"caret-down"}})],1),t._l(t.globalWaypointTurnModes,(function(i,a){return e("a-select-option",{key:a,attrs:{value:i.value}},[t._v(" "+t._s(i.text)+" ")])}))],2)],1),e("div",{staticClass:"task-line-module take-off"},[t._m(8),e("a-select",{staticStyle:{width:"54%"},attrs:{"dropdown-class-name":"black-theme"},model:{value:t.heightMode,callback:function(e){t.heightMode=e},expression:"heightMode"}},[e("template",{slot:"suffixIcon"},[e("a-icon",{attrs:{type:"caret-down"}})],1),t._l(t.heightModes,(function(i,a){return e("a-select-option",{key:a,attrs:{value:i.value}},[t._v(" "+t._s(i.text)+" ")])}))],2)],1)],1)]),e("div",{directives:[{name:"show",rawName:"v-show",value:"point"===t.settingType&&t.pointsList&&t.pointsList.length>0,expression:"settingType === 'point' && pointsList && pointsList.length > 0"}],staticClass:"setting-c"},[e("a-carousel",{ref:"pointCarousel",attrs:{arrows:"",dots:!1,"before-change":t.beforeCarouselChange}},[e("div",{staticClass:"custom-slick-arrow",staticStyle:{left:"0",zIndex:"1"},attrs:{slot:"prevArrow"},slot:"prevArrow"},[e("a-icon",{attrs:{type:"caret-left"}})],1),e("div",{staticClass:"custom-slick-arrow",staticStyle:{right:"0","text-align":"right"},attrs:{slot:"nextArrow"},slot:"nextArrow"},[e("a-icon",{attrs:{type:"caret-right"}})],1),t._l(t.pointsList,(function(i,a){return e("div",{key:a,staticClass:"point-name"},[t._v(" 航点"+t._s(i.text)+" ")])}))],2),e("div",[e("div",{staticClass:"operate-panel"},[e("Panel",{on:{handlePanel:t.handlePanel}}),e("div",{staticClass:"lat-lng-module"},[e("div",{staticClass:"input-module task-name"},[e("div",{staticClass:"label"},[t._v(" 经度 ")]),e("a-input",{model:{value:t.lng,callback:function(e){t.lng=t._n(e)},expression:"lng"}})],1),e("div",{staticClass:"input-module task-name"},[e("div",{staticClass:"label"},[t._v(" 纬度 ")]),e("a-input",{model:{value:t.lat,callback:function(e){t.lat=t._n(e)},expression:"lat"}})],1)])],1),e("div",{staticClass:"num-c"},[e("div",{staticClass:"custom-name-module task-name"},[e("div",{staticClass:"module-title"},[t._m(9),e("a-input",{model:{value:t.customName,callback:function(e){t.customName=e},expression:"customName"}},[e("img",{attrs:{slot:"suffix",src:i("1e1d")},slot:"suffix"})])],1),e("PlanSlider",{attrs:{value:t.speed,title:"飞行速度",unit:"m/s",icon:i("c091"),min:1,max:15,step:1},on:{change:function(e){return t.sliderChangeEvent(e,"speed")}}}),e("PlanSlider",{attrs:{value:t.altitude,title:"飞行高度",unit:"m",icon:i("8e1c"),min:20,max:500,step:1},on:{change:function(e){return t.sliderChangeEvent(e,"altitude")}}}),e("PlanSlider",{attrs:{value:t.gimbalPitch,title:"云台俯仰角度",unit:"°",icon:i("5dec"),min:-90,max:0,step:.1},on:{change:function(e){return t.sliderChangeEvent(e,"gimbalPitch")}}}),e("div",{staticClass:"head-module"},[e("a-switch",{staticClass:"head-btn",attrs:{size:"small","checked-children":"航线跟随","un-checked-children":"自定义"},on:{change:t.headFollowChange},model:{value:t.headFollow,callback:function(e){t.headFollow=e},expression:"headFollow"}}),t.headFollow?e("div",{staticClass:"module-title"},[t._m(10)]):e("PlanSlider",{attrs:{value:t.heading,title:"机身偏航角度",unit:"°",icon:i("805b"),min:-180,max:180,step:.1},on:{change:function(e){return t.sliderChangeEvent(e,"heading")}}})],1)],1),e("Actions",{ref:"actions",on:{chosenList:t.chosenList}})],1)])],1)]],2),e("div",{directives:[{name:"permission",rawName:"v-permission",value:"route/route/waypoint",expression:"'route/route/waypoint'"}],staticClass:"x-icon-btn",on:{click:t.submitTask}},[e("img",{attrs:{src:i("e95e"),alt:""}}),e("span",[t._v(" 提交任务 ")])])]),e("div",{staticClass:"map-custom"},[e("Map",{attrs:{"site-i-d":t.siteID}})],1),e("KmlUpload",{directives:[{name:"permission",rawName:"v-permission",value:"route/route/waypoint",expression:"'route/route/waypoint'"}],on:{initKmlData:t.initKmlData}})],1)},s=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"common-header"},[e("div",{staticClass:"dot"}),e("div",{staticClass:"title"},[t._v(" 路点巡航 ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"icon"},[e("img",{attrs:{src:i("cc11")}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"icon"},[e("img",{attrs:{src:i("c5844")}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"icon"},[e("img",{attrs:{src:i("3261")}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"no-point"},[e("img",{attrs:{src:i("4484")}}),e("div",[t._v(" 请绘制航点 ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"label-module"},[e("img",{attrs:{src:i("270d")}}),e("span",{staticClass:"label"},[t._v("航点拍照")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"label-module"},[e("img",{attrs:{src:i("5dec")}}),e("span",{staticClass:"label"},[t._v("航段轨迹尽量贴合")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"label-module"},[e("img",{attrs:{src:i("c091")}}),e("span",{staticClass:"label"},[t._v("转弯模式")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"label-module"},[e("img",{attrs:{src:i("8e1c")}}),e("span",{staticClass:"label"},[t._v("高度模式")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"num-name"},[e("img",{staticClass:"num-icon",attrs:{src:i("dbc2")}}),t._v(" 航点名称自定义 ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"num-name"},[e("img",{staticClass:"num-icon",attrs:{src:i("805b")}}),t._v(" 机身偏航角度 ")])}],n=(i("14d9"),i("13d5"),i("2f62")),o=i("1157"),l=i.n(o),c=i("d30b"),r=i("595b"),d=i("70b0"),u=i.n(d),h=i("95dc"),m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"panel"},[e("div",{staticClass:"direction-forward",on:{click:function(e){return t.handle("latUp")}}}),e("div",{staticClass:"direction-back",on:{click:function(e){return t.handle("latDown")}}}),e("div",{staticClass:"direction-left",on:{click:function(e){return t.handle("lngDown")}}}),e("div",{staticClass:"direction-right",on:{click:function(e){return t.handle("lngUp")}}})])},g=[],p={methods:{handle(t){this.$emit("handlePanel",t)}}},v=p,f=(i("1227"),i("2877")),b=Object(f["a"])(v,m,g,!1,null,"734cece7",null),x=b.exports,A=i("5fed"),P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"actions-self"},[e("div",{staticClass:"x-title"},[t._v(" 航点动作 "),e("div",{staticClass:"add-btn",on:{click:function(e){e.stopPropagation(),t.showList=!t.showList}}},[t._v(" 添加 "),e("a-icon",{staticClass:"add-icon",attrs:{type:"plus"}})],1),t.showList?e("div",{staticClass:"action-list"},t._l(t.actionList,(function(i,a){return e("div",{key:a,staticClass:"action-item",on:{click:function(e){return t.chose(i)}}},[t._v(" "+t._s(i.text)+" ")])})),0):t._e()]),t._l(t.chosenList,(function(a,s){return e("div",{key:s},[e("div",{staticClass:"sub-title"},[t._v(" 动作"+t._s(s+1)+" "),e("div",{staticClass:"del-icon",on:{click:function(e){return t.actionDel(s)}}},[e("img",{attrs:{src:i("75a8")}})])]),e("div",{staticClass:"action-detail"},[e("PlanSlider",{attrs:{value:Number(a["value_"+s]),title:a.text,unit:a.unit,min:Number(a.min),max:Number(a.max),step:Number(a.step)},on:{change:function(e){return t.sliderChangeEvent(e,s)}}})],1)])}))],2)},y=[],_={components:{PlanSlider:A["a"]},data(){return{showList:!1,chosenList:[],actionList:[{text:"拍照",key:5,value:-1},{text:"悬停等待",key:1,value:30,min:1,max:600,step:1,unit:"s"},{text:"开始录影",key:2,value:-1},{text:"停止录影",key:3,value:-1},{text:"调整飞行器偏航角",key:6,value:0,min:-180,max:180,step:.1,unit:"°"},{text:"调整云台俯仰角",key:4,value:-90,min:-90,max:0,step:.1,unit:"°"},{text:"变焦",key:7,value:5,min:2,max:30,step:.1,unit:"倍"},{text:"云台航偏角绝对调整",key:8,value:0,min:-180,max:180,step:.1,unit:"°"},{text:"云台航偏角相对调整",key:9,value:0,min:-180,max:180,step:.1,unit:"°"},{text:"开始等时间隔拍照",key:10,value:20,min:1,max:30,step:1,unit:"s"},{text:"开始等距间隔拍照",key:11,value:20,min:1,max:100,step:1,unit:"m"},{text:"停止间隔拍照",key:12,value:-1}]}},watch:{chosenList(t){this.$emit("chosenList",t)}},methods:{actionDel(t){this.chosenList.forEach((e,i)=>{i>=t&&(e["value_"+(i-1)]=e["value_"+i],delete e["value_"+i])}),this.chosenList.splice(t,1),this.$message.success("航点动作删除成功！")},sliderChangeEvent(t,e){this.$set(this.chosenList,e,{...this.chosenList[e],["value_"+e]:t})},closeActionsSelect(){this.showList=!1},chose(t){this.chosenList.push(t);const e=this.chosenList.length-1;this.chosenList[e]["value_"+e]=t.value,this.showList=!1},getData(t){if(this.chosenList=[],t&&t.actions&&t.actions.length>0){const e={};this.actionList.forEach(t=>{e[t.key]=t}),t.actions.forEach((i,a)=>{e[i.key]?(i.text=e[i.key].text,i.min=e[i.key].min,i.max=e[i.key].max,i.step=e[i.key].step,i.unit=e[i.key].unit):t.actions.splice(a,1)}),this.chosenList=t.actions}}}},k=_,F=(i("0664"),Object(f["a"])(k,P,y,!1,null,"6eb65ed5",null)),C=F.exports,S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"kml-upload"},[e("div",{staticClass:"kml-btn"},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){t.kmlModal=!0}}},[t._v(" 文件导入 ")])],1),e("a-modal",{staticClass:"black-modal kml-task-modal",attrs:{"mask-closable":!1,footer:null,centered:""},on:{cancel:function(e){t.kmlModal=!1}},model:{value:t.kmlModal,callback:function(e){t.kmlModal=e},expression:"kmlModal"}},[e("div",{staticClass:"title"},[e("div",{staticClass:"text"},[t._v(" 新建任务 ")])]),e("div",{staticClass:"filter-box"},[e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v(" 文件类型 ")]),e("a-select",{staticClass:"item-content",attrs:{"dropdown-class-name":"black-theme"},model:{value:t.fileType,callback:function(e){t.fileType=e},expression:"fileType"}},[e("template",{slot:"suffixIcon"},[e("a-icon",{attrs:{type:"caret-down"}})],1),e("a-select-option",{key:"kmz",attrs:{value:"kmz"}},[t._v(" KMZ ")]),e("a-select-option",{key:"kml",attrs:{value:"kml"}},[t._v(" KML ")]),e("a-select-option",{key:"json",attrs:{value:"json"}},[t._v(" JSON ")])],2)],1),e("div",{staticClass:"item"},[e("div",{staticClass:"label"},[t._v(" 导入任务 ")]),e("UploadFile",{attrs:{"file-type":t.fileType},on:{upload:t.upload}})],1)]),e("div",{staticClass:"btn-box"},[e("div",{staticClass:"x-btn",on:{click:t.createKml}},[e("img",{attrs:{src:"/home/btn-confirm.png",alt:""}}),e("span",[t._v(" 确定 ")])]),e("div",{staticClass:"x-btn ghost",on:{click:function(e){t.kmlModal=!1}}},[e("img",{attrs:{src:"/home/btn-cancel.png",alt:""}}),e("span",[t._v(" 取消 ")])])])])],1)},w=[],T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mission-upload item-content"},[e("a-upload",{attrs:{name:"file",accept:".kml,.json,.kmz","custom-request":t.customRequest},on:{change:t.handleChange}},[e("a-button",{staticStyle:{width:"138px"},attrs:{disabled:"done"===t.fileStatus}},[e("a-icon",{attrs:{type:"upload"}}),t._v(" 导入任务 ")],1)],1),t.routes.length>1?e("div",{staticClass:"item",staticStyle:{"margin-left":"-20%"}},[e("div",{staticClass:"label"},[t._v(" 选择第 ")]),e("a-select",{staticClass:"item-content",staticStyle:{width:"30%"},attrs:{"dropdown-class-name":"black-theme"},on:{change:t.chooseKmzFolder},model:{value:t.indexChoosed,callback:function(e){t.indexChoosed=e},expression:"indexChoosed"}},[e("template",{slot:"suffixIcon"},[e("a-icon",{attrs:{type:"caret-down"}})],1),t._l(t.routes,(function(i){return e("a-select-option",{key:i,attrs:{value:i}},[t._v(" "+t._s(i)+" ")])}))],2),e("div",{staticClass:"label",staticStyle:{"text-align":"left","margin-left":"10px"}},[t._v(" 条航线 ")])],1):t._e()],1)},L=[],N=i("98fc"),M=i.n(N),D=i("c4e3"),E=i.n(D),I={props:{fileType:{type:String,default:""}},data(){return{indexChoosed:1,dialogVisible:!1,fileStatus:"",fileName:"",cameraNameText:"",autoFlightSpeed:{},missionConfig:{},originFileObj:{},Folders:[],flightParams:{}}},computed:{routes(){const t=[];return this.Folders.forEach((e,i)=>{t.push(i+1)}),t}},watch:{fileType(t,e){t!==e&&e&&"done"===this.fileStatus&&this.parseDocument(this.originFileObj)}},methods:{chooseKmzFolder(){this.dialogVisible=!1;const t=this.Folders[this.indexChoosed-1];this.setFlightParamsByFolder(this.flightParams,t),this.$emit("upload",this.flightParams)},customRequest(t){this.$nextTick(()=>{t.onSuccess()})},handleChange(t){const{file:{status:e="",originFileObj:i,name:a=""}={}}=t;"done"===e&&(this.fileStatus=e,this.fileName=a,this.originFileObj=i,this.parseDocument(i)),"removed"===e&&(this.Folders=[],this.indexChoosed=1,this.flightParams={},this.fileStatus="",this.$emit("upload",{}))},parseDocument(t){if(!t)return;const e=new FileReader;e&&(e.onload=e=>{if(!this.checkType(e.target.result))return void this.$emit("upload",{});let i=null;if("kmz"===this.fileType){if(i=this.parseKmz(t),!i)return}else i=this.readFile(e.target.result);i&&this.$emit("upload",i)},e.readAsText(t))},checkType(t){if("kml"===this.fileType){const e=new DOMParser,i=e.parseFromString(t,"text/xml"),{nodeName:a}=i.documentElement;if("kml"!==a)return this.$message.error("选择的类型和上传文件格式不匹配，请检查后重试"),!1}const e=this.fileName.split(".");return"kmz"===this.fileType&&"kmz"!==e[e.length-1]?(this.$message.error("选择的类型和上传文件格式不匹配，请检查后重试"),!1):"json"!==this.fileType||"json"===e[e.length-1]||(this.$message.error("选择的类型和上传文件格式不匹配，请检查后重试"),!1)},readFile(t){let e=null;const i={};if("kml"===this.fileType){var a;const s=new M.a;e=s.xml2js(t);const{kml:{Document:{Placemark:{ExtendedData:{altitude:n,autoFlightSpeed:o,droneInfo:{droneCameras:{camera:{cameraName:l={}}={}}}={}},LineString:c}}}}=e;this.cameraNameText=null!==(a=l.__text)&&void 0!==a?a:"";const r=Array.isArray(e.kml.Document.Folder.Placemark)?e.kml.Document.Folder.Placemark:[e.kml.Document.Folder.Placemark];i.flightPath=r.map(this.iterationParam),i.cruiseSpeed=parseFloat(null===o||void 0===o?void 0:o.__text),i.cruiseAltitude=parseFloat(null===n||void 0===n?void 0:n.__text)||120,i.cruiseGimbal=-45,i.GCSType=1,"absolute"===(null===c||void 0===c?void 0:c.altitudeMode)&&(i.absoluteToRelative=!0)}else if("json"===this.fileType){const e=JSON.parse(t);Object.assign(i,e.flightParams)}return i},iterationParam(t,e){const{ExtendedData:{actions:i=[],preciseShotInfo:a=null,gimbalPitch:s,heading:n},Point:{coordinates:o}}=t,[l,c,r]=o.split(","),[d,u]=[parseFloat(c),parseFloat(l)],h={index:e++,altitude:parseFloat(r),latitude:d,longitude:u,gimbalPitch:parseFloat(s.__text),heading:parseFloat(n.__text),actions:this.iterationAction(i,a)};return h},addActionsBeforePreciseShot(t,e,i){let a=1,s=0,n=0;if(Array.isArray(e.preciseInfo)&&e.preciseInfo[i]){const t=e.preciseInfo[i];a=parseFloat(t.focalDistance.__text),s=parseFloat(t.gimbalPitch.__text),n=parseFloat(t.gimbalYaw.__text),a=["42","43","61"].includes(t.cameraType.__text)?Number((parseFloat(a)/10*4/95.1).toFixed(2)):Number((parseFloat(a)/10/24).toFixed(2))}else a=parseFloat(e.preciseInfo.focalDistance.__text),s=parseFloat(e.preciseInfo.gimbalPitch.__text),n=parseFloat(e.preciseInfo.gimbalYaw.__text),a=["42","43","61"].includes(e.preciseInfo.cameraType.__text)?Number((parseFloat(a)/10*4/95.1).toFixed(2)):Number((parseFloat(a)/10/24).toFixed(2));t.push({index:t.length+1,action:4,actionParams:s}),t.push({index:t.length+1,action:6,actionParams:n}),t.push({index:t.length+1,action:7,actionParams:a}),t.push({index:t.length+1,action:5})},iterationAction(t,e){if(!t)return[];Array.isArray(t)||(t=[t]);const i=[];let a=0;const s=[];return t.forEach((t,n)=>{let o={index:n+1,action:0};switch(t.__text){case"GimbalPitch":o.action=4,o.actionParams=parseFloat(t._param),t._accuracy&&"1"===t._accuracy&&(o.actionParams/=10),s.push(o);break;case"ShootPhoto":o.action=5,s.push(o);break;case"PreciseShot":o.action=5,this.addActionsBeforePreciseShot(i,e,a),a+=1,o=null;break;case"AircraftYaw":case"GimbalYaw":o.action=6,o.actionParams=parseFloat(t._param),t._accuracy&&"1"===t._accuracy&&(o.actionParams/=10),s.push(o);break;case"CameraZoom":if(o.action=7,this.cameraNameText.includes("H20")){let e=Number((4*parseFloat(t._param)/95.1).toFixed(2));t._accuracy&&"1"===t._accuracy&&(e=Number((parseFloat(t._param)/10*4/95.1).toFixed(2))),o.actionParams=e}else{let e=Number((parseFloat(t._param)/24).toFixed(2));t._accuracy&&"1"===t._accuracy&&(e=Number((parseFloat(t._param)/10/24).toFixed(2))),o.actionParams=e}o&&s.push(o);break;default:break}}),s},parseKmz(t){const e={},i=new E.a;return i.loadAsync(t).then(t=>{Object.keys(t.files).forEach(i=>{"wpmz/waylines.wpml"!==i&&"wpmz\\waylines.wpml"!==i||t.files[i].async("string").then(t=>{const i=new M.a,a=i.xml2js(t);console.log("解析结果：",a);let{kml:{Document:{Folder:s,missionConfig:n}}}=a;if(this.missionConfig=n,Array.isArray(s)){if(1!==s.length)return this.dialogVisible=!0,this.Folders=s,this.flightParams=e,this.setFlightParamsByFolder(this.flightParams,s[0]),!1;[s]=s}this.setFlightParamsByFolder(e,s)}).catch(t=>{console.error(t),this.$message.error("解析异常！")})})},t=>{console.error(t),this.$message.error(`解析异常: ${this.fileName}: ${t.message}`)}).catch(t=>{console.error(t)}),e},setFlightParamsByFolder(t,e){const{Placemark:i,autoFlightSpeed:a,executeHeightMode:s}=e;this.autoFlightSpeed=a;let n=i;Array.isArray(i)||(n=[i]),t.cruiseSpeed=parseFloat(a.__text),"relativeToStartPoint"===s.__text?t.heightMode=0:"EGM96"===s.__text?t.absoluteToRelative=!0:"WGS84"===s.__text?t.heightMode=2:(s.__text,t.heightMode=0),t.cruiseAltitude=120,t.cruiseGimbal=-45,t.cruiseGimbalPitch=-45,t.GCSType=1,t.flightPath=n.map(this.iterationKMZ)},iterationKMZ(t){var e,i;const[a,s]=t.Point.coordinates.split(","),[n,o]=[parseFloat(s),parseFloat(a)],l={altitude:parseFloat(t.executeHeight),latitude:n,longitude:o,gimbalPitch:0,heading:0,speed:1,actions:[]};if(null!==t&&void 0!==t&&null!==(e=t.gimbalPitchAngle)&&void 0!==e&&e.__text&&(l.gimbalPitch=parseFloat(t.gimbalPitchAngle.__text)),t.waypointSpeed?l.speed=Number(t.waypointSpeed.__text):l.speed=parseFloat(this.autoFlightSpeed.__text),"smoothTransition"===(null===(i=t.waypointHeadingParam)||void 0===i||null===(i=i.waypointHeadingMode)||void 0===i?void 0:i.__text)?l.heading=Number(Number(t.waypointHeadingParam.waypointHeadingAngle.__text).toFixed(0)):l.heading=-9999,null!==t&&void 0!==t&&t.actionGroup){let e=[];e=Array.isArray(t.actionGroup)?t.actionGroup:[t.actionGroup];let i=[];const a=[];e.forEach(t=>{null!==t&&void 0!==t&&t.action&&(Array.isArray(t.action)?i.push(...t.action):i.push(t.action),i.forEach(e=>{const i=this.actionKMZ(e,null===t||void 0===t?void 0:t.actionTrigger);Array.isArray(i)?a.push(...i):a.push(i)}))}),i=a.filter(t=>null!=t.action),l.actions=i}return l},actionKMZ(t,e){var i,a,s,n,o;const l={action:null},c=t.actionActuatorFunc.__text;switch(c){case"hover":l.action=1,l.actionParams=parseFloat(t.actionActuatorFuncParam.hoverTime.__text);break;case"startRecord":l.action=2;break;case"stopRecord":l.action=3;break;case"gimbalRotate":const c=[];return"1"===t.actionActuatorFuncParam.gimbalYawRotateEnable.__text&&("relativeAngle"===t.actionActuatorFuncParam.gimbalRotateMode.__text?c.unshift({action:9,actionParams:Number(parseFloat(t.actionActuatorFuncParam.gimbalYawRotateAngle.__text).toFixed(2))}):c.unshift({action:8,actionParams:Number(parseFloat(t.actionActuatorFuncParam.gimbalYawRotateAngle.__text).toFixed(2))})),"1"===t.actionActuatorFuncParam.gimbalPitchRotateEnable.__text&&c.unshift({action:4,actionParams:Number(parseFloat(t.actionActuatorFuncParam.gimbalPitchRotateAngle.__text).toFixed(2))}),c;case"takePhoto":case"accurateShoot":case"orientedShoot":const u=null===(i=t.actionActuatorFuncParam)||void 0===i||null===(i=i.aircraftHeading)||void 0===i?void 0:i.__text,h=null===(a=t.actionActuatorFuncParam)||void 0===a||null===(a=a.gimbalYawRotateAngle)||void 0===a?void 0:a.__text,m=null===(s=t.actionActuatorFuncParam)||void 0===s||null===(s=s.gimbalPitchRotateAngle)||void 0===s?void 0:s.__text,g=null===(n=t.actionActuatorFuncParam)||void 0===n||null===(n=n.focalLength)||void 0===n?void 0:n.__text,p=null===(o=t.actionActuatorFuncParam)||void 0===o||null===(o=o.accurateCameraType)||void 0===o?void 0:o.__text,v=[];if(e){var r,d;const t=null===(r=e.actionTriggerType)||void 0===r?void 0:r.__text,i=null===(d=e.actionTriggerParam)||void 0===d?void 0:d.__text;"multipleTiming"===t?v.push({action:10,actionParams:parseInt(parseFloat(i).toFixed(2))}):"multipleDistance"===t?v.push({action:11,actionParams:Number(parseFloat(i).toFixed(2))}):v.push({action:5})}else v.push({action:5});if(g){let t=0;t=["42","43","61"].includes(p)?Number((4*parseFloat(g)/95.1).toFixed(2)):Number((parseFloat(g)/24).toFixed(2)),v.unshift({action:7,actionParams:t})}return m&&v.unshift({action:4,actionParams:Number(parseFloat(m).toFixed(2))}),h&&v.unshift({action:8,actionParams:Number(parseFloat(h).toFixed(2))}),u&&v.unshift({action:6,actionParams:Number(parseFloat(u).toFixed(2))}),v;case"rotateYaw":l.action=6,l.actionParams=Number(parseFloat(t.actionActuatorFuncParam.aircraftHeading.__text).toFixed(2));break;case"zoom":l.action=7;let f=Number(parseFloat(t.actionActuatorFuncParam.focalLength.__text).toFixed(2));f=["42","43","61"].includes(this.missionConfig.payloadInfo.payloadEnumValue.__text)?Number((4*parseFloat(f)/95.1).toFixed(2)):Number((parseFloat(f)/24).toFixed(2)),l.actionParams=f;break;default:break}return l}}},O=I,U=(i("d979"),Object(f["a"])(O,T,L,!1,null,"47a1a081",null)),R=U.exports,Z={components:{UploadFile:R},data(){return{kmlModal:!1,fileType:"kmz",uploadData:{}}},methods:{upload(t){this.uploadData=t,console.log("data:",t)},createKml(){"{}"!==JSON.stringify(this.uploadData)&&(this.kmlModal=!1,this.$emit("initKmlData",this.uploadData))}}},G=Z,z=(i("d31b"),i("7422"),Object(f["a"])(G,S,w,!1,null,"506975da",null)),j=z.exports,K=i("6c72"),B=i("ed08"),V=i("aa86"),q=i("e350"),H=i("3151");let Y=null,W=null,Q=null,J=-1,X=-1,$=null,tt=null,et=null,it=null,at=null,st=[],nt=null,ot=[],lt=[],ct=[],rt=[],dt=null,ut=null,ht=null;const mt=5e-6;var gt={components:{Map:h["a"],Panel:x,PlanSlider:A["a"],Actions:C,KmlUpload:j,ScreenShot:K["a"]},mixins:[H["a"]],data(){return{hiveTypes:[1,6,7],shrinkLeft:!1,pointsNum:0,distance:0,totalDistance:0,flyTime:0,missionName:"新建航点飞行任务",customName:"",address:"",cruiseSpeed:8,cruiseAltitude:100,cruiseGimbalPitch:-45,lat:"",lng:"",speed:8,altitude:100,gimbalPitch:-45,heading:-9999,finishedAction:"GO_HOME",settingType:"point",pointsList:[],currentSettingPoint:-1,finishedActionList:[{text:"自动返航",value:"GO_HOME"},{text:"悬停",value:"NO_ACTION"},{text:"自动降落",value:"AUTO_LAND"}],dragging:!1,siteID:"",siteAltitude:0,missionID:"",hangarPoint:[],isGPhoto:!1,globalUseStraightLine:!1,heightMode:0,globalWaypointTurnMode:1,heightModes:[{text:"相对起飞点高度",value:0},{text:"海拔高度",value:1},{text:"椭球高度",value:2}],globalWaypointTurnModes:[{text:"协调转弯",value:1},{text:"直线飞行",value:2},{text:"曲线飞行,到点停",value:3},{text:"曲线飞行,到点不停",value:4}],loading:!1,headFollow:!0,siteMode:0,siteSFMode:1,initDataFlag:!1,addressCalcFlag:!1}},watch:{cruiseSpeed(t){this.getFlightTime(),this.speed=t,st.forEach(e=>{e.speed=t})},currentSettingPoint(t){t>=0&&this.$nextTick(()=>{this.setActivePointIndex(t),this.lat=st[t].lat84,this.lng=st[t].lng84,this.headFollow=-9999===st[t].heading,this.speed=st[t].speed,this.altitude=st[t].altitude,this.gimbalPitch=st[t].gimbalPitch,this.heading=st[t].heading,this.customName=st[t].name,this.$refs.actions&&this.$refs.actions.getData(st[t])})},lng(t){if(this.currentSettingPoint>=0){if(this.dragging)return;this.latlngUpdate({lat:this.lat,lng:t})}},lat(t){if(this.currentSettingPoint>=0){if(this.dragging)return;this.latlngUpdate({lat:t,lng:this.lng})}},altitude(t){this.currentSettingPoint>=0&&(st[this.currentSettingPoint].altitude=t)},speed(t){this.currentSettingPoint>=0&&(st[this.currentSettingPoint].speed=t)},gimbalPitch(t){this.currentSettingPoint>=0&&(st[this.currentSettingPoint].gimbalPitch=t)},heading(t){this.currentSettingPoint>=0&&(st[this.currentSettingPoint].heading=t)},customName(t){this.currentSettingPoint>=0&&(st[this.currentSettingPoint].name=t)},cruiseAltitude(t){this.altitude=t,st.forEach(e=>{e.altitude=t})},cruiseGimbalPitch(t){this.gimbalPitch=t,st.forEach(e=>{e.gimbalPitch=t})},pointsNum(t){if(this.pointsList=[],t){-1===this.currentSettingPoint?this.currentSettingPoint=0:this.$refs.pointCarousel&&this.$refs.pointCarousel.goTo(0);for(let e=0;e<t;e+=1)this.pointsList.push({text:""+(e+1),value:e})}else this.currentSettingPoint=-1}},beforeMount(){this.$root.$on("mapOnfinished",async t=>{Y=t.L,W=t.map,$=Y.divIcon({iconSize:[24,24],className:"xl-point-icon",html:"<div></div>"}),it=Y.divIcon({iconSize:[24,24],className:"anchor-icon",html:"<div></div>"}),tt=Y.divIcon({iconSize:[0,0],className:"xl-del-icon",html:'<div class="del-icon"><div class="del-black"></div><div class="del-white"></div></div>'}),et=Y.divIcon({className:"move-tip",html:"单击放置航点"}),dt=Y.divIcon({className:"hangar-icon",iconSize:[48,48],html:"<div></div>"}),W.createPane("anchorLayers"),W.getPane("anchorLayers").style.zIndex=402,W.getPane("anchorLayers").style.pointerEvents="none",await this.drawSite(),this.initMap(),this.initData()})},beforeDestroy(){this.lineDel(),this.delLineLayer(),at&&(W.removeLayer(at),at=null),ut&&(W.removeLayer(ut),ut=null),this.$root.$off("mapOnfinished"),Y=null,W=null,J=-1,X=-1},methods:{...Object(n["b"])({getSiteInfo:"mission/getSiteInfo",addMissions:"mission/addMissions",updateMissions:"mission/updateMissions",getMissionInfo:"mission/getMissionInfo"}),headFollowChange(t){this.currentSettingPoint>=0&&(t?st[this.currentSettingPoint].heading=-9999:(st[this.currentSettingPoint].heading=90,this.heading=90))},latlngUpdate({lat:t,lng:e}){const[i,a]=Object(V["c"])(e,t);st[this.currentSettingPoint].setLatLng([a,i]),this.updateCurrentPoint({lng:i,lat:a,lng84:e,lat84:t,index:this.currentSettingPoint})},beforeCarouselChange(t,e){this.currentSettingPoint=e},handlePanel(t){switch(t){case"latUp":this.lat=Number((this.lat+mt).toFixed(8));break;case"latDown":this.lat=Number((this.lat-mt).toFixed(8));break;case"lngUp":this.lng=Number((this.lng+mt).toFixed(8));break;case"lngDown":this.lng=Number((this.lng-mt).toFixed(8));break;default:break}},chosenList(t){this.currentSettingPoint>=0&&(st[this.currentSettingPoint].actions=t)},async drawSite(){const{query:{siteID:t=""}={}}=this.$route;if(!t)return;this.siteID=t;const{siteLocation:e=[],siteAltitude:i=0,siteMode:a=0,siteSFMode:s=1,hiveInfo:n={}}=await this.getSiteInfo(t);if(this.siteMode=a,this.siteAltitude=i,this.siteSFMode=s,e.length>0&&e[1]&&e[0]){const[t,i]=Object(V["c"])(e[0],e[1]);if(this.hiveTypes.includes(this.siteMode)){this.hangarPoint=[i,t];const e=null===n||void 0===n?void 0:n.hiveModel;let s="hangar-icon";e&&(s=`${s} ${this.getSiteIconClassName(a,e)}`),dt=Y.divIcon({className:s,iconSize:[48,48],html:"<div></div>"}),ut=Y.marker(this.hangarPoint,{icon:dt}).addTo(W)}W.setView([i,t])}},initMap(){Object(q["b"])("route","route","waypoint")&&this.eventBind()},initKmlData(t){this.lineDel(),this.initDataFlag=!0;const{heightMode:e=0,globalWaypointTurnMode:i=1,cruiseAltitude:a="",cruiseSpeed:s="",flightPath:n=[],cruiseGimbalPitch:o="",cruiseGimbal:l="",isGPhoto:c=!1,globalUseStraightLine:r=1,absoluteToRelative:d=!1}=t;this.cruiseAltitude=a,this.cruiseSpeed=s,this.isGPhoto=c,this.globalUseStraightLine=2===r,this.heightMode=e,this.globalWaypointTurnMode=i,this.cruiseGimbalPitch=o||l,this.$nextTick(()=>{n.forEach(t=>{const e=[];t.actions&&t.actions.length&&t.actions.forEach((t,i)=>{e.push({key:t.action,["value_"+i]:t.actionParams})});const[i,a]=Object(V["c"])(t.longitude.toFixed(8),t.latitude.toFixed(8));this.pointDraw({lat:a,lng:i,lat84:t.latitude,lng84:t.longitude,altitude:(d?t.altitude-this.siteAltitude:t.altitude)||this.altitude,speed:t.speed||this.speed,gimbalPitch:t.gimbalPitch||0,heading:t.heading||0,name:t.name||this.customName,actions:e},!1)}),this.locationCenter()})},initData(){const{id:t=""}=this.$route.query;t&&(this.missionID=t,this.getMissionInfo({missionID:this.missionID}).then(({data:t})=>{const{missionName:e,flightParams:{heightMode:i=0,globalWaypointTurnMode:a=1,cruiseAltitude:s="",cruiseSpeed:n="",cruiseGimbalPitch:o="",flightPath:l=[],isGPhoto:c=!1,globalUseStraightLine:r=1}={}}=t;this.initDataFlag=!0,this.missionName=e,this.heightMode=i,this.globalWaypointTurnMode=a,this.cruiseAltitude=s,this.cruiseSpeed=n,this.cruiseGimbalPitch=o,this.isGPhoto=c,this.globalUseStraightLine=2===r,this.$nextTick(()=>{l.forEach(t=>{const e=[];t.actions&&t.actions.length&&t.actions.forEach((t,i)=>{e.push({key:t.action,["value_"+i]:t.actionParams})});const[i,a]=Object(V["c"])(t.longitude,t.latitude);this.pointDraw({lat:Number(a.toFixed(8)),lng:Number(i.toFixed(8)),lat84:t.latitude,lng84:t.longitude,altitude:t.altitude,speed:t.speed,gimbalPitch:t.gimbalPitch,heading:t.heading,name:t.name,actions:e},!1)}),this.locationCenter()})}))},closeActionsSelect(){this.$refs.actions.closeActionsSelect()},sliderChangeEvent(t,e){this[e]=t},eventBind(){W.on("click",t=>{this.initDataFlag=!1;const e=Number(t.latlng.lat.toFixed(8)),i=Number(t.latlng.lng.toFixed(8)),[a,s]=Object(V["b"])(i,e);this.pointDraw({lat:e,lng:i,lat84:s,lng84:a},!1)}).on("mousemove",t=>{Y&&(at?at.setLatLng([t.latlng.lat,t.latlng.lng]):at=Y.marker([t.latlng.lat,t.latlng.lng],{icon:et,pane:"tooltipPane"}).addTo(W))})},updateCurrentPoint(t){const{lat:e,lng:i,lng84:a,lat84:s,index:n}=t;st[n].lat=e,st[n].lng=i,st[n].lat84=s,st[n].lng84=a,this.lineDraw()},pointDraw(t,e){var i,a,s,n,o;if(!t||!t.lat||!t.lng||this.dragging)return;if(!t.lng84||!t.lat84){const[e,i]=Object(V["b"])(t.lng,t.lat);t.lng84=e,t.lat84=i}if(e){const{lat:e,lng:i}=t;X=rt.findIndex(t=>{const[a,s]=t;return s===e&&a===i})}const c=Y.marker([t.lat,t.lng],{icon:$,draggable:!0}).addTo(W).on("click",t=>{this.currentSettingPoint=l()(t.target._icon).html()-1,this.$refs.pointCarousel&&this.$refs.pointCarousel.goTo(this.currentSettingPoint)}).on("contextmenu",t=>{this.delPt(t)}).on("dragstart",t=>{J=l()(t.target._icon).html()-1}).addTo(W).on("drag",t=>{this.dragging=!0;let{latlng:{lat:e,lng:i}={}}=t;e=Number(e.toFixed(8)),i=Number(i.toFixed(8));const[a,s]=Object(V["b"])(i,e);J===this.currentSettingPoint&&(this.lat=s,this.lng=a),this.updateCurrentPoint({lat:e,lng:i,lat84:s,lng84:a,index:J})}).on("dragend",()=>{setTimeout(()=>{this.dragging=!1},500)}).on("mouseover",()=>{l()(".move-tip").addClass("long").text("右击删除点，拖拽改变位置")}).on("mouseout",()=>{l()(".move-tip").removeClass("long").text("单击放置航点")});Object.assign(c,{lat:t.lat||"",lng:t.lng||"",lat84:t.lat84||"",lng84:t.lng84||"",altitude:null!==(i=t.altitude)&&void 0!==i?i:this.cruiseAltitude,speed:null!==(a=t.speed)&&void 0!==a?a:this.cruiseSpeed,gimbalPitch:null!==(s=t.gimbalPitch)&&void 0!==s?s:this.cruiseGimbalPitch,heading:null!==(n=t.heading)&&void 0!==n?n:this.heading,name:null!==(o=t.name)&&void 0!==o?o:this.customName,actions:t.actions||[]}),e?st.splice(X+1,0,c):st.push(c),this.lineDraw()},lineDraw(){const t=st.reduce((t,e)=>(t.push([e._latlng.lat,e._latlng.lng]),t),[]);Q?Q.setLatLngs(t):Q=Y.polyline(t,{color:"yellow",weight:4}).addTo(W),this.drawHangarLine(),this.anchorDraw(),this.getEveryDistance(),this.addressCalc(),this.delBtnSet(),this.setEveryPointIndex(),this.distanceCalc(),this.pointsNum=st.length},anchorDraw(){ct.length>0&&this.anchorDel();const t=st.length;if(!(t<2)){for(let e=0;e<t-1;e+=1){const[t,i]=Object(r["midpoint"])(Object(c["c"])([st[e].lng,st[e].lat]),Object(c["c"])([st[e+1].lng,st[e+1].lat])).geometry.coordinates;rt.push([Number(t.toFixed(8)),Number(i.toFixed(8))])}rt.forEach(t=>{ct.push(Y.marker([t[1],t[0]],{icon:it,pane:"anchorLayers"}).addTo(W).on("click",t=>{this.anchorAddPoint(t.latlng)}))})}},anchorDel(){ct.forEach(t=>{W.removeLayer(t)}),ct=[],rt=[]},getEveryDistance(){ot.length&&(ot.forEach(t=>{W.removeLayer(t)}),ot=[],lt=[]),st.forEach((t,e)=>{const i=t.getLatLng();let a=0,s=!1;if(e>0?(s=!0,a=Number((st[e-1].getLatLng().distanceTo(i)/1e3).toFixed(2))):0===e&&this.hiveTypes.includes(this.siteMode)&&0!==this.hangarPoint.length&&(s=!0,a=Number((i.distanceTo({lat:this.hangarPoint[0],lng:this.hangarPoint[1]})/1e3).toFixed(2))),s){lt.push(a);const t=Y.marker([i.lat,i.lng],{icon:Y.divIcon({className:"distance-tip",html:a+"km"})}).addTo(W);ot.push(t)}})},async addressCalc(){if(!st[0])return;if(this.initDataFlag&&this.addressCalcFlag)return;this.addressCalcFlag=!0;const{info:t="",regeocode:e={}}=await Object(B["c"])(st[0].lng,st[0].lat);if("OK"===t){const{addressComponent:{province:t="",city:i="",district:a="",township:s=""}={}}=e;this.address=`${t}${i}${a}${s}`}else this.address=""},distanceCalc(){this.distance=0,this.flyTime=0;let t=0;st.forEach((e,i)=>{i>0?this.distance+=st[i-1].getLatLng().distanceTo(e.getLatLng()):0===i&&0!==this.hangarPoint.length&&(t=st[0].getLatLng().distanceTo({lat:this.hangarPoint[0],lng:this.hangarPoint[1]}))}),this.totalDistance=this.distance+t,this.distance=Number((this.totalDistance/1e3).toFixed(2)),this.getFlightTime()},getFlightTime(){this.totalDistance&&(this.flyTime=Number(((this.totalDistance/this.cruiseSpeed+3*(st.length+2)+160)/60).toFixed(2)))},drawHangarLine(){st.length&&this.hangarPoint.length&&(ht?ht.setLatLngs([this.hangarPoint,[st[0].lat,st[0].lng]]):ht=Y.polygon([this.hangarPoint,[st[0].lat,st[0].lng]],{color:"yellow",fillColor:"#00FFE8",fillOpacity:.12,weight:4}).addTo(W))},delHangarLine(){ht&&(W.removeLayer(ht),ht=null)},anchorAddPoint(t){this.pointDraw({lat:Number(t.lat.toFixed(8)),lng:Number(t.lng.toFixed(8))},!0)},delPt(t){W.removeLayer(t.target),st.some((e,i)=>{if(e._latlng.lat===t.latlng.lat&&e._latlng.lng===t.latlng.lng)return st.splice(i,1),!0}),(!st||st.length<=0)&&(nt&&(W.removeLayer(nt),nt=null),this.delHangarLine()),l()(".move-tip").removeClass("long").text("单击放置航点"),this.lineDraw()},lineDel(){nt&&(W.removeLayer(nt),nt=null),st.forEach(t=>{W.removeLayer(t)}),st=[],this.currentSettingPoint=-1,J=-1,X=-1,l()(".move-tip").show(),this.lineDraw(),this.delHangarLine()},delLineLayer(){Q&&(W.removeLayer(Q),Q=null)},setEveryPointIndex(){st.forEach((t,e)=>{l()(t._icon).html(""+(e+1))})},setActivePointIndex(t){l()(".xl-point-icon").removeClass("xl-active-icon"),st.forEach(e=>{Number(l()(e._icon).html())===t+1&&l()(e._icon).addClass("xl-active-icon")})},delBtnSet(){if(!st[st.length-1])return;const t=st[st.length-1];nt?nt.setLatLng([t.lat,t.lng]):(nt=Y.marker([t.lat,t.lng],{icon:tt,draggable:!0}).addTo(W).on("click",()=>{this.lineDel()}),nt.bindTooltip("<div>删除航线</div>",{direction:"bottom",offset:Y.point(33,15),className:"del-tip"}).addTo(W).on("mouseover",()=>{l()(".move-tip").hide()}).on("mouseout",()=>{l()(".move-tip").show()}))},locationCenter(){if(st.length){const t=st[st.length-1];W.setView([t.lat,t.lng])}},submitTask(){if(!st||st.length<=1)return void this.$message.warning("至少创建两个航点");const t=[].concat(lt);this.hiveTypes.includes(this.siteMode)&&0!==this.hangarPoint.length&&t.shift();const e=t.findIndex(t=>1e3*t>1500);if(-1!==e){const t=e+1;return void this.$message.warning(`第${t}个点和第${t+1}个点距离需要小于1.5km，请重新绘制`)}if(1===this.siteSFMode&&0!==this.hangarPoint.length){const t=st.find(t=>t.getLatLng().distanceTo({lat:this.hangarPoint[0],lng:this.hangarPoint[1]})>6e3);if(t)return void this.$message.warning("所有航点距离机库的位置不能超过6km，请重新绘制")}if(!this.missionName)return void this.$message.warning("名称不能为空");this.loading=!0;const i=document.getElementById("map");u.a.toPng(i,{width:i.clientWidth,height:i.clientHeight,quality:1}).then(t=>{this.loading=!1,this.$refs.screenShot.saveThumbFun(t,t=>{this.saveTask(t)})}).catch(()=>{this.loading=!1,this.saveTask(null)})},async saveTask(t){const e=[];st.forEach((t,i)=>{if(!st[i])return;const a={index:i,name:t.name,latitude:t.lat84,longitude:t.lng84,altitude:t.altitude,gimbalPitch:t.gimbalPitch,heading:t.heading,speed:t.speed,actions:t.actions.length?t.actions.map((t,e)=>({index:e,action:t.key,actionParams:t["value_"+e]})):[]};e.push(a)});const i={missionName:this.missionName,missionType:1,ASType:2,UAVModel:"",cameraModel:"",siteID:this.siteID,flightParams:{GCSType:1,heightMode:this.heightMode,globalWaypointTurnMode:this.globalWaypointTurnMode,cruiseSpeed:this.cruiseSpeed,cruiseAltitude:this.cruiseAltitude,cruiseGimbalPitch:this.cruiseGimbalPitch,cruiseUAVYaw:90,isGPhoto:this.isGPhoto,globalUseStraightLine:this.globalUseStraightLine?2:1,THPTotal:this.pointsNum,flightPath:e}};t&&(i.thumbnailBase64=t);let a="add";this.missionID&&(i.missionID=this.missionID,a="update");const s=await this[a+"Missions"](i);0===s&&this.$router.push("/route")}}},pt=gt,vt=(i("6e6c"),i("6d74"),Object(f["a"])(pt,a,s,!1,null,"9538c236",null));e["default"]=vt.exports},"605d":function(t,e,i){"use strict";var a=i("da84"),s=i("c6b6");t.exports="process"===s(a.process)},"6ba4":function(t,e,i){},"6d74":function(t,e,i){"use strict";i("b39d")},"6e1b":function(t,e,i){},"6e6c":function(t,e,i){"use strict";i("6ba4")},7422:function(t,e,i){"use strict";i("6e1b")},"75a8":function(t,e,i){t.exports=i.p+"img/del_white.40568959.svg"},7797:function(t,e,i){},"805b":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAA4ZJREFUSEutlk1oVFcUx//3JROzmJSqUHCh0FJo6TRVqUIUBWkXpSmtrZDZFJPc80wCWaS4ERFkmIWIi3aREEqSee/Og6ZIUqj0A0opdOE3VWtbR0sJOJhu/FgFJMTn3CM3zB3evL44ztgHwwz3nXt+55z7v+eMmJubawOAbDZbMd++728mosVcLudkMhlh1p71KZVKnM/ntfVh9ln/wvzo6+vTExMTHel0+nsA7wA4TkQnm4FZiFLqM2b+HMDZ5eXlD0dHRx/Oz887qyCTTbFYzGitb5gomPkf13Vfi0bUKKtIRa4D2Fr1s9N13SuGUQMFQfBWpVL5o+rwIhHtbhH0K4B9a4KUUtuY+fcq6CYRZVoBeZ73ixDi3aqft4noWl1Gs7Oz61dWVhYAbADwFREdZGZh6tuobFExPRVkDYMg2Ki17i6Xy+cA6GZUZ8/oqaBSqSTy+fzjaOQmXbOeyWS4mYx83/8RQG9i6Z5H3jYTG4zv++cBrArJcZwdg4ODV+vOqBl5m8CEELVMlVKvM/MhAJ8AeMVCmXm367oXm5K3vZDWyeTkZLqzs3O/EOIAAPOJP/+GYbh9ZGTkQR0oJu8bRNSddDZKqV5m3g/gYwAvxW2Y+bzjOKeklKbL1LcgU2el1IvMvAggDeBrIvrUOlFK9TDzRwD6ALyaEMCiEOI0gHkp5W9BEGwZGBi48x+QlffMzMzL7e3tW6WUZ6ql6XUcp5+ZP0jKTgjxs9b6266uLj+bzT4yNp7nHRVCnASwEIbhjuHh4aVar4vKe2pqalNHR8cRZj4IYGMC4Aozf6e1/mZoaOhW/L3v+9cAbK+u9xDR5doZGRUVi8V1zHwGwHvxzUKI21rrH0x5iOhC/L5FO4Pv+w17XTcz/xmDnAXwpZTydFTOdsZEbSPd2/TLbeadEGKXlPJSXHVR0N+VSuVAtDSNZlNk6H0B4DCAuwC6iej+mhfWHLKUcrWESdEnCcO2KzvblpaWFsbGxlbqJmx88AE4R0R7WwWNj4+vMxCzP5fLtZt+mThhWwSt/l9QSh1j5hMArodhuK9O3v9HRkmjHEC9vI1RoVB403Gcv0y6po24rrunmdJFQA3lHR3lt4jojRZBa8vbXNjp6ekXUqmUyWgzgAIRDTUzyteSt5TyQa0F2ZtdKBQ2tLW19ZTL5Z/MWjOj3NhbmOd576dSqav9/f33rLyfAOn2wFPBLaRBAAAAAElFTkSuQmCC"},"8aed":function(t,e,i){},a640:function(t,e,i){"use strict";var a=i("d039");t.exports=function(t,e){var i=[][t];return!!i&&a((function(){i.call(null,e||function(){return 1},1)}))}},aeb6:function(t,e,i){},b39d:function(t,e,i){},d31b:function(t,e,i){"use strict";i("aeb6")},d58f:function(t,e,i){"use strict";var a=i("59ed"),s=i("7b0b"),n=i("44ad"),o=i("07fa"),l=TypeError,c=function(t){return function(e,i,c,r){a(i);var d=s(e),u=n(d),h=o(d),m=t?h-1:0,g=t?-1:1;if(c<2)while(1){if(m in u){r=u[m],m+=g;break}if(m+=g,t?m<0:h<=m)throw new l("Reduce of empty array with no initial value")}for(;t?m>=0:h>m;m+=g)m in u&&(r=i(r,u[m],m,d));return r}};t.exports={left:c(!1),right:c(!0)}},d979:function(t,e,i){"use strict";i("8aed")},dbc2:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAAXNSR0IArs4c6QAAAy9JREFUSEutlUtoHWUUx39n7sKAQYSQVFpRcNGFUlFQfHTho1SRWhXEhUhl5kzgVtG40IV1IXGjLgTlSrGFO+fLjV0KPpBSRbSCFhREFBRELIrS+KqvoKS51znylUlMmpv70JzdzPd9/9+c/3fOGWGIaDabu5IkaQAvqOozQxxFhtlsZt8Dm6ozJ4C6qr4+iMbAIDN7EthXluWttVotcfcmMOHuL+Z5fm8/2ECg2dnZiU6n8wNwVFVviKJFUeQi0hSRA1mW3bchIDM7ClwH/OHue9z9vSRJvgPmVXXJyp6svhmZ2c3AEXc/IiJR9PIIBM4BtqvqsX7ZxPVBQL8C56rq6b1m9hzwEPCOqt44CKQvKIRwv7vvB/aq6sEK9Apwu4hszbLsy/8NajQaZ42Oji4A36rqBVEwhBDvZxY4qKp7B4X0zMjM3gR2JklyRZqmH1XZ/A38qarxfoaKrncUQrjM3T8Gjqnq9gryBPA4cJeqvjQUZb1iMLOvgIvcfUue5yeazeaFSZJ8DXyuqpcMC+lqXQhB3b0AHlPVp6psPgMuHrYAqrOxPa5cY52ZdYBTqnp23DgzM7OjLMu3gMOqumvYbEIIb7j7TatAZvY88ACwe2lYmlkcPRNlWY5NTk7+8h9Ah9z9nmVQCGGbu38qIh9mWXZVNc8eFZFoX6qqrWEhlcasiOxZBhVF8YmIXLp0D+4uIYQS+FlVx9eDhBB2uvuOqrAcqAHHsyw7ICJeFMW/oBDCbnd/beXIN7NXgduA61X13fVAZmZAdsb6ySzLxteAzOwwcMuKeXYt8D7wtqrGr+0ZrVZry+Li4ml3arWatNvtk/V6/a811plZnMDXrAD9CIy32+3N9Xp9rh+o1/oq68wsToHz46W5+yFgzN335Xn+9JkiZnY3cHUvcRH5Jk3TZ7tZF22KhxPA3f3OPM9f7ia21Bd9svwpy7JN3UC/xx+ZiOyfn59/eGpq6lQvoVarNbawsCAjIyOxypYjvosPc3Nzv01PT8fGj7/8VVW3TUTKNE3jqNnQKIqiISIPipk9Ei0TkY67b636YENgleYdwHlSFMUXsUk3RHl9kQ/+Ac6Cfk5kxG0fAAAAAElFTkSuQmCC"}}]);
//# sourceMappingURL=chunk-9762e490.1704762109123.js.map