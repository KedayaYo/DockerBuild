(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-74680c1d"],{"352be":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"stand-alone-list-wrapper has-padding"},[t("el-card",[t("el-title",{attrs:{slot:"header"},slot:"header"},[e._v(" 单机列表 ")]),t("el-form",{attrs:{size:"small",model:e.searchForm,inline:!0},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{directives:[{name:"permission",rawName:"v-permission",value:"standAlone/standAlone/add",expression:"'standAlone/standAlone/add'"}],staticClass:"float-right"},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v(" 新建 ")])],1)],1),t("el-table",{attrs:{data:e.standAloneList,"text-align":"center","header-cell-style":e.headStyle,"row-class-name":e.tableRowClassName,"cell-style":e.rowStyle,height:"100px"}},[t("template",{slot:"empty"},[t("NoResult",{attrs:{"has-margin":!1}})],1),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t("el-table-column",{attrs:{label:"编号",prop:"siteID"}}),t("el-table-column",{attrs:{label:"名称",prop:"siteName"}}),t("el-table-column",{attrs:{label:"无人机编号",prop:"UAVID"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.UAVInfo&&t.row.UAVInfo.UAVID)+" ")]}}])}),t("el-table-column",{attrs:{label:"配置模式",prop:"siteMode"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("matching")(t.row.siteMode))+" ")]}}])}),t("el-table-column",{attrs:{label:"飞行模式"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{size:"mini",type:1===s.row.siteSFMode?"success":"warning"}},[e._v(" "+e._s(1===s.row.siteSFMode?"孤岛模式":"跳棋模式")+" ")])]}}])}),t("el-table-column",{attrs:{label:"创建时间",prop:"createTime"}}),t("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"standAlone/standAlone/update",expression:"'standAlone/standAlone/update'"}],attrs:{type:"text"},on:{click:function(t){return e.handleEdit(s.row,!1)}}},[e._v(" 修改 "),t("i",{staticClass:"el-icon-edit"})]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"standAlone/standAlone/delete",expression:"'standAlone/standAlone/delete'"}],staticStyle:{color:"#eb5300"},attrs:{type:"text"},on:{click:function(t){return e.handleDeleteStandAlone(s.row.siteID)}}},[e._v(" 删除 "),t("i",{staticClass:"el-icon-delete"})]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(s.row,!0)}}},[e._v(" 详情 "),t("i",{staticClass:"el-icon-search"})])]}}])})],2),t("el-row",{staticClass:"sorter-wrap"},[t("el-pagination",{staticClass:"x-pagination float-right",attrs:{background:"",layout:"total, prev, pager, next, jumper","current-page":e.tableConfig.page,"page-size":e.tableConfig.size,total:e.tableConfig.total},on:{"current-change":e.handleChangeCPage}})],1),t("el-dialog",{staticClass:"protective-line",attrs:{center:"",visible:e.dialogVisible},on:{close:function(t){return e.handleClose("StandAloneForm")}}},[t("el-title",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.isEdit?e.disabled?"详情":"编辑":"新建")+" ")]),t("el-form",{ref:"StandAloneForm",attrs:{disabled:e.disabled,"label-position":"right","label-width":"140px",rules:e.rules,size:"small",model:e.standAloneDetails}},[t("el-row",{attrs:{gutter:20}},[e.isEdit?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"编号"}},[e._v(" "+e._s(e.standAloneDetails.siteID)+" ")])],1):e._e(),t("el-col",{attrs:{span:e.isEdit?12:24}},[t("el-form-item",{attrs:{label:"名称",prop:"siteName"}},[t("el-input",{model:{value:e.standAloneDetails.siteName,callback:function(t){e.$set(e.standAloneDetails,"siteName",t)},expression:"standAloneDetails.siteName"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"飞行模式",prop:"siteSFMode"}},[t("el-select",{model:{value:e.standAloneDetails.siteSFMode,callback:function(t){e.$set(e.standAloneDetails,"siteSFMode",t)},expression:"standAloneDetails.siteSFMode"}},[t("el-option",{attrs:{value:1,label:"孤岛模式"}}),t("el-option",{attrs:{value:2,label:"跳棋模式"}})],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"配置模式",prop:"siteMode"}},[t("el-select",{model:{value:e.standAloneDetails.siteMode,callback:function(t){e.$set(e.standAloneDetails,"siteMode",e._n(t))},expression:"standAloneDetails.siteMode"}},e._l(e.SITEMODEL,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"无人机编号"}},[t("el-select",{attrs:{clearable:""},model:{value:e.standAloneDetails.UAVID,callback:function(t){e.$set(e.standAloneDetails,"UAVID",t)},expression:"standAloneDetails.UAVID"}},e._l(e.droneList,(function(e){return t("el-option",{key:e.UAVID,attrs:{value:e.UAVID,label:e.UAVID}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"边缘计算机"}},[t("el-select",{model:{value:e.standAloneDetails.ECID1,callback:function(t){e.$set(e.standAloneDetails,"ECID1",t)},expression:"standAloneDetails.ECID1"}},e._l(e.computerList,(function(e){return t("el-option",{key:e.ECID,attrs:{label:e.ECID,value:e.ECID}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实时播流配置"}},[t("el-input",{model:{value:e.standAloneDetails.videoPullAddr,callback:function(t){e.$set(e.standAloneDetails,"videoPullAddr",t)},expression:"standAloneDetails.videoPullAddr"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"实时推流配置"}},[t("el-input",{model:{value:e.standAloneDetails.videoPushAddr,callback:function(t){e.$set(e.standAloneDetails,"videoPushAddr",t)},expression:"standAloneDetails.videoPushAddr"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"上传图片"}},[e.standAloneDetails.thumbnailBase64?t("el-button",{attrs:{type:"text",icon:"el-icon-picture-outline"},on:{click:function(t){e.imgCropperDialogVisible=!0}}},[e._v(" "+e._s(e.standAloneDetails.siteName)+" ")]):t("el-button",{on:{click:function(t){e.imgCropperDialogVisible=!0}}},[t("i",{staticClass:"el-icon-upload"}),e._v(" 上传图片 ")])],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.disabled?e._e():t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-success"},on:{click:function(t){return e.submit("StandAloneForm")}}},[e._v("确 定")]),t("el-button",{attrs:{plain:"",size:"small",icon:"el-icon-error",type:"primary"},on:{click:function(t){return e.resetForm("StandAloneForm")}}},[e._v("取 消")])],1)],1),t("el-drawer",{attrs:{visible:e.imgCropperDialogVisible,"before-close":e.handleCloseImgCropper}},[t("el-title",{attrs:{slot:"title"},slot:"title"},[e._v(" 裁剪器 ")]),e.imgCropperDialogVisible?t("ImgCropper",{attrs:{"base-code":e.standAloneDetails.thumbnailBase64},on:{sendCropperImg:e.handleCropperImg}}):e._e()],1)],1)],1)},l=[],i=(s("d9e2"),s("13d5"),s("14d9"),s("a670")),o=s("61f7"),n=s("514b"),r={name:"StandAlone",components:{ImgCropper:i["a"]},filters:{matching(e){const t={3:"单兵中枢",4:"遥控器",5:"机载计算机"};return t[e]}},data(){return{disabled:!1,dialogVisible:!1,isEdit:!1,imgCropperDialogVisible:!1,standAloneList:[],droneList:[],computerList:[],standModes:[3,4,5],SITEMODEL:[{value:3,label:"单兵中枢"},{value:4,label:"遥控器"},{value:5,label:"机载计算机"}],searchForm:{corporation:""},tableConfig:{page:1,size:20,total:0,isSiteType:0},standAloneDetails:{siteID:"",siteName:"",siteAddress:"",siteMode:"",siteSFMode:"",UAVID:"",ECID1:"",videoPullAddr:"",videoPushAddr:""},rules:{UAVID:[{required:!0,message:"请选择无人机",trigger:"change"}],siteName:[{required:!0,validator:o["k"],trigger:"blur"}],siteMode:[{required:!0,message:"请选择站点模式",trigger:"change"}],siteSFMode:[{required:!0,message:"请选择类型",trigger:"change"}],ECID1:[{required:!0,message:"请选择边缘计算机",trigger:"change"}]}}},created(){this.getStandAloneList(this.tableConfig),this.getDroneList(1,500),this.getComputerList()},methods:{headStyle(){return"text-align:center;background:#F4F7FD"},rowStyle(){return"text-align:center"},tableRowClassName({rowIndex:e}){return e%2===0?"even-number":"uneven-number"},handleChangeCPage(e){this.tableConfig.page=e,this.getStandAloneList(this.tableConfig)},async handleEdit(e,t){this.disabled=t;const{code:s,data:a,reason:l}=await this.$store.dispatch("site/getSiteDetail",{siteID:e.siteID});if(!Object(n["a"])(s))return this.$message.error("站点详情获取失败："+l);this.isEdit=!0;const i=this.$deepClone(a);return Object.keys(this.standAloneDetails).forEach(e=>{var t;"UAVID"===e?this.standAloneDetails.UAVID=null===(t=i.UAVInfo)||void 0===t?void 0:t.UAVID:this.standAloneDetails[e]=i[e]}),this.dialogVisible=!0,""},handleClose(e){this.resetForm(e)},handleCloseImgCropper(){this.imgCropperDialogVisible=!1},handleCropperImg(e){const{close:t,base64:s}=e;this.standAloneDetails.thumbnailBase64=s,t&&this.handleCloseImgCropper()},handleDeleteStandAlone(e){this.$confirm("此操作将此单机系统, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{code:t,reason:s}=await this.$store.dispatch("site/deleteSite",{siteID:e});return Object(n["a"])(t)?(this.$message({type:"success",message:"删除成功!"}),this.getStandAloneList(this.tableConfig),""):this.$message.error(s)}).catch(e=>{throw this.$message({type:"info",message:"已取消删除"}),console.error(e),new Error(e)})},submit(e){this.$refs[e].validate(async t=>{if(t){const t=this.$deepClone(this.standAloneDetails);Object.keys(t).forEach(e=>{t[e]||"UAVID"===e||delete t[e]}),this.isEdit&&(t.siteID=this.standAloneDetails.siteID);const{code:s,reason:a}=this.isEdit?await this.$store.dispatch("site/updateSiteDetails",t):await this.$store.dispatch("site/appendSite",t),l=Object(n["a"])(s);if(this.$message[l?"success":"error"](`${this.isEdit?"修改":"新建"}单机信息 ${l?"成功":"失败"}${l?"":a}`),!l)throw new Error("error");this.getStandAloneList(this.tableConfig),this.resetForm(e)}return!1})},resetForm(e){this.dialogVisible=!1,this.isEdit=!1,this.disabled=!1,this.$refs[e].resetFields(),Object.keys(this.standAloneDetails).forEach(e=>{this.standAloneDetails[e]=""})},async getDroneList(){const{code:e,data:t,reason:s}=await this.$store.dispatch("uav/getDroneList",{page:1,size:500});if(!Object(n["a"])(e))return this.$message.error("获取无人机列表失败："+s);const{list:a}=t;return this.droneList=a,a},async getComputerList(e=1,t=500,s=""){const{code:a,data:l,reason:i}=await this.$store.dispatch("computer/getComputerList",{page:e,size:t,ECID:s});if(!Object(n["a"])(a))return this.$message("请求失败："+i);const{list:o}=l;return this.computerList=o,o},async getStandAloneList({page:e,size:t,PID:s="",isSiteType:a=0,siteIDs:l=""}){const{code:i,data:o,reason:r}=await this.$store.dispatch("site/getSiteList",{page:e,size:t,PID:s,isSiteType:a,siteIDs:l});if(!Object(n["a"])(i))return this.$message.error("请求失败："+r);const{list:d,total:c}=o;return this.standAloneList=d.reduce((e,t)=>(this.standModes.includes(t.siteMode)&&e.push(t),e),[]),this.tableConfig.total=void 0===c?this.tableConfig.total:c||0,d}}},d=r,c=s("2877"),u=Object(c["a"])(d,a,l,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-74680c1d.1704762109123.js.map