import{_ as P}from"./index.9fa6ecce.js";/* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css               */import{d as M,f as F,r as R,o as w,C as B,aE as x,aI as n,aJ as a,D as T,aL as V,aK as O,u as U,b5 as j,b6 as z,bN as K,bO as L,bb as Z,b_ as q,m as I,c as N,t as H,aS as k,aG as E,aN as h,aO as A,bC as J,b9 as W,bZ as Q,bW as X,aZ as Y,ba as $,bG as ee,be as te,b2 as oe}from"./arco.35cd4a57.js";import{r as S}from"./role.management.9e0cf398.js";/* empty css              *//* empty css               */import{r as ne}from"./resource.api.6dab745f.js";import"./chart.c690dcf1.js";import"./vue.1515c820.js";const ae=[{label:"\u7981\u7528",value:-1},{label:"\u542F\u7528",value:1}],ue=[{label:"\u666E\u901A\u7528\u6237",value:1},{label:"\u7279\u6B8A\u7528\u6237",value:2}],G=M({__name:"Form",props:{roleCurrent:{type:Object,default:()=>({})}},setup(g,{expose:C}){const p=g,t=(_,r)=>{const o=/^[\w\u4e00-\u9fa5]{2,10}$/;return _?o.test(_)?r():r("\u652F\u6301 _\u3001\u6587\u5B57\u3001\u6570\u5B57\u3001\u5B57\u6BCD,\u4E14\u957F\u5EA62-10"):r("\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0")},d=F(),f=R({roleName:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{validator:t}]}),m=F({roleName:"",type:1,status:1}),v=()=>new Promise((_,r)=>{d.value.validate(o=>{const e=o?{code:400,message:o.roleName.message}:null;o?r(e):_(m)})});return w(()=>{p.roleCurrent.id&&(m.value={...p.roleCurrent,roleID:p.roleCurrent.id})}),C({handleSubmit:v}),(_,r)=>{const o=j,e=z,u=K,b=L,D=Z;return B(),x(D,{ref_key:"formRef",ref:d,model:m.value,"label-col-props":{span:3},rules:f},{default:n(()=>[a(e,{field:"roleName",label:"\u540D\u79F0",prop:"roleName"},{default:n(()=>[a(o,{modelValue:m.value.roleName,"onUpdate:modelValue":r[0]||(r[0]=c=>m.value.roleName=c),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(e,{label:"\u7C7B\u578B"},{default:n(()=>[a(b,{modelValue:m.value.type,"onUpdate:modelValue":r[1]||(r[1]=c=>m.value.type=c),placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272\u7C7B\u578B"},{default:n(()=>[(B(!0),T(V,null,O(U(ue),c=>(B(),x(u,{key:c.value,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(e,{label:"\u72B6\u6001"},{default:n(()=>[a(b,{modelValue:m.value.status,"onUpdate:modelValue":r[2]||(r[2]=c=>m.value.status=c),placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272\u72B6\u6001"},{default:n(()=>[(B(!0),T(V,null,O(U(ae),c=>(B(),x(u,{key:c.value,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])}}}),le=M({__name:"Tree",props:{roleCurrent:{type:Object,default:()=>({})}},setup(g,{expose:C}){const p=g,t=F(),d=F([]),f=F([]),m=()=>new Promise(o=>{const e=t.value.getHalfCheckedNodes();console.log([...d.value,...e.map(u=>u)]);debugger;o([...d.value,...e.map(u=>u)])}),v=(o,e)=>{if(!o)return[];for(const u of o){const{id:b}=u;e.push(b),u.children&&u.children.length&&v(u.children,e)}return e},_=(o="")=>new Promise(e=>{ne.getAll(o).then(u=>{if(u.code===0){const{data:{list:b}}=u;e(b)}})}),r=async o=>{_(o).then(e=>{d.value=v(e,[])})};return w(()=>{var o,e;_().then(u=>{f.value=u}),(o=p.roleCurrent)!=null&&o.id&&r((e=p.roleCurrent)==null?void 0:e.id.toString())}),C({handleSubmit:m}),(o,e)=>{const u=q;return B(),x(u,{ref_key:"treeRef",ref:t,"checked-keys":d.value,"onUpdate:checkedKeys":e[0]||(e[0]=b=>d.value=b),"default-expand-all":!0,checkable:!0,data:f.value,"check-strictly":!0,"field-names":{key:"id",title:"name",icon:"customIcon"}},null,8,["checked-keys","data"])}}}),re={components:{ArcoForm:G},setup(){const g=F(!1),C=F(),p=F(),t=F(!1),d=R([{name:"Form",comName:I(G)},{name:"Tree",comName:I(le)}]),f=F(d[0]),m=N(()=>{const l=()=>t.value?"\u4FEE\u6539\u89D2\u8272\u4FE1\u606F":"\u65B0\u589E\u89D2\u8272\u4FE1\u606F";return f.value.name==="Tree"?"\u6743\u9650\u8BBE\u7F6E":l()}),v=R({dataSource:[]}),_=N(()=>l=>l.status===-1?{color:"red",text:"\u7981\u7528"}:{color:"green",text:"\u542F\u7528"}),r=N(()=>l=>l.type===2?{color:"red",text:"\u7279\u6B8A\u89D2\u8272"}:{color:"green",text:"\u666E\u901A\u89D2\u8272"}),o=async()=>{const l=await S.getAll();v.dataSource=l.data.map((s,i)=>({...s,expand:!0,key:i.toString()}))},e=()=>{const[l]=d;return f.value=l,t.value=!1,p.value={remark:"",roleCode:"",roleName:"",status:1,type:1},!0},u=(l,s)=>{p.value=l,f.value=s,g.value=!0},b=l=>{p.value=l;const[s]=d;f.value=s,t.value=!0,g.value=!0},D=l=>C.value.handleSubmit().then(s=>{var i;if((s==null?void 0:s.code)===400){k.error(s.message);return}f.value.name==="Form"?S[t.value?"update":"create"](s.value).then(y=>{y.code===0?(k.success("\u8BF7\u6C42\u6210\u529F"),o(),l()):Promise.reject(y)}):S.setRoleResource((i=p.value)==null?void 0:i.id,s.map(y=>y.toString())).then(y=>{y.code===0?(k.success("\u8BF7\u6C42\u6210\u529F"),o(),l()):Promise.reject(y)})}).catch(s=>(k.error(s.message),!1)),c=l=>{S.remove(l.id).then(s=>{s.code===0?(k.success("\u5220\u9664\u6210\u529F"),o()):k.error("\u5220\u9664\u5931\u8D25")})};return w(()=>{o()}),{visible:g,roleCurrent:p,AsyncComponent:C,asyncComponents:d,CurrentComponent:f,modalTitle:m,...H(v),roleStatusComput:_,roleTypeComput:r,reloadAsyncComponent:e,handleGetComponentSubmit:D,handleUpdateRoleResource:u,handleUpdate:b,handleRemove:c}}};const se={class:"role-management-wrap container"};function ce(g,C,p,t,d,f){const m=W,v=Q,_=E("icon-github"),r=X,o=E("icon-settings"),e=Y,u=E("icon-edit"),b=E("icon-delete"),D=$,c=ee,l=te,s=oe;return B(),T("div",se,[a(l,{style:{width:"100%"},title:"\u89D2\u8272\u7BA1\u7406"},{extra:n(()=>[a(m,{onClick:C[0]||(C[0]=i=>t.visible=!0)},{default:n(()=>[h("\u65B0\u589E")]),_:1})]),default:n(()=>[a(c,{data:g.dataSource},{columns:n(()=>[a(v,{title:"\u540D\u79F0","data-index":"roleName"}),a(v,{title:"\u72B6\u6001","data-index":"status"},{cell:n(({record:i})=>[a(r,{color:t.roleStatusComput(i).color},{icon:n(()=>[a(_)]),default:n(()=>[h(" "+A(t.roleStatusComput(i).text),1)]),_:2},1032,["color"])]),_:1}),a(v,{title:"\u7C7B\u578B","data-index":"type"},{cell:n(({record:i})=>[a(r,{color:t.roleTypeComput(i).color},{icon:n(()=>[a(_)]),default:n(()=>[h(" "+A(t.roleTypeComput(i).text),1)]),_:2},1032,["color"])]),_:1}),a(v,{title:"\u64CD\u4F5C","data-index":"optional",align:"center",width:300},{cell:n(({record:i})=>[a(D,{size:"mini"},{default:n(()=>[a(e,{type:"primary",size:"mini",onClick:y=>t.handleUpdateRoleResource(i,t.asyncComponents[1])},{icon:n(()=>[a(o)]),default:n(()=>[h(" \u6743\u9650\u8BBE\u7F6E ")]),_:2},1032,["onClick"]),a(e,{type:"primary",size:"mini",onClick:y=>t.handleUpdate(i)},{icon:n(()=>[a(u)]),default:n(()=>[h(" \u4FEE\u6539 ")]),_:2},1032,["onClick"]),a(e,{type:"primary",status:"danger",size:"mini",onClick:y=>t.handleRemove(i)},{icon:n(()=>[a(b)]),default:n(()=>[h("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1}),a(s,{visible:t.visible,"onUpdate:visible":C[1]||(C[1]=i=>t.visible=i),"title-align":"start","unmount-on-close":!0,"mask-closable":!1,"on-before-ok":t.reloadAsyncComponent,"on-before-cancel":t.reloadAsyncComponent,"modal-class":"async-modal-wrap",onBeforeOk:t.handleGetComponentSubmit},{title:n(()=>[h(A(t.modalTitle),1)]),default:n(()=>[(B(),x(J(t.CurrentComponent.comName),{ref:"AsyncComponent","role-current":t.roleCurrent},null,8,["role-current"]))]),_:1},8,["visible","on-before-ok","on-before-cancel","onBeforeOk"])])}const Ae=P(re,[["render",ce]]);export{Ae as default};
