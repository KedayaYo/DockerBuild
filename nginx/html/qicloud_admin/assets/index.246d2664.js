import{_ as re}from"./index.9fa6ecce.js";/* empty css                *//* empty css               *//* empty css              *//* empty css               *//* empty css                *//* empty css               *//* empty css                */import{u as ie}from"./upload.aab3b5b0.js";/* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css               */import{d as de,f as u,r as Y,c as Z,t as ce,aS as _,b9 as pe,bF as me,aG as $,aZ as fe,ba as Ae,bG as ge,be as Fe,b5 as ve,bH as be,bI as Te,bb as Le,b8 as Pe,bJ as Ce,a$ as he,D as w,aJ as o,aI as n,b2 as Ee,C as F,aN as c,aO as O,aE as z,G as y,E as Ie,aF as ke,aL as Q,aK as X,b6 as Be,bK as _e,bL as we}from"./arco.35cd4a57.js";import{t as p}from"./terrace.management.1f90c17c.js";import"./chart.c690dcf1.js";import"./vue.1515c820.js";const ye=4,De=de({setup(){const e=u([{title:"\u5E8F\u53F7",dataIndex:"id",align:"center",sortable:{sortDirections:["ascend","descend"]}},{title:"\u5E73\u53F0\u540D\u79F0",dataIndex:"PLATName"},{title:"\u5E73\u53F0\u7F16\u53F7",dataIndex:"PLATCode",align:"center"},{title:"\u5E73\u53F0\u95E8\u6237\u7F51\u5740",dataIndex:"PLATAccessWebsite",slotName:"PLATAccessWebsite"},{title:"\u5E73\u53F0\u6620\u5C04\u7F51\u5740",dataIndex:"PLATMappedAddress",slotName:"PLATMappedAddress"},{title:"Logo",dataIndex:"PLATLogoUrl",align:"center",slotName:"PLATLogoUrl"},{title:"\u63CF\u8FF0",dataIndex:"description"},{title:"\u521B\u5EFA\u4EBA",dataIndex:"createUser",align:"center"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",align:"center"},{title:"\u64CD\u4F5C",dataIndex:"optional",slotName:"Optional",align:"center"}]),s=u(!1),D=u("\u65B0\u589E\u5E73\u53F0\u4FE1\u606F"),C=u(!1),J=u([]),m=u([]),A=u([]),h=u({}),E=u([]),g=u(),V=u(!1),v=u(!1),f=u([]),I=u([]),b=u("site"),r=u({url:""}),i=Y({terraceInfo:{PLATName:"",PLATID:"",description:"",PLATLogoUrl:"",PLATAccessWebsite:"",PLATMappedAddress:""}}),L=u({PLATName:"",current:1,pageSize:30,total:0,showTotal:!0}),k=u(""),M=t=>{console.log(m.value);debugger;m.value=t.target.checked?f.value.map(l=>l.id):[]},W=Z(()=>k.value?f.value.filter(t=>t.siteName.includes(k.value)):f.value),q=Z({get:()=>m.value.length===f.value.length,set:t=>{m.value=t?f.value.map(l=>l.id):[]}}),U=Y({PLATName:[{required:!0,message:"\u5E73\u53F0\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{validator:(t,l)=>{const d=/^[\w\u4e00-\u9fa5]{2,10}$/;return t?d.test(t)?l():l("\u652F\u6301 _\u3001\u6587\u5B57\u3001\u6570\u5B57\u3001\u5B57\u6BCD,\u4E14\u957F\u5EA62-10"):l("\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0")}}],PLATAccessWebsite:[{required:!0,message:"\u5E73\u53F0\u7F51\u5740\u4E0D\u80FD\u4E3A\u7A7A"},{validator:(t,l)=>{const d="\u4F8B\u5982\uFF1Ahttp://www.baidu.com/ or http://192.168.0.1:8080/",T=/^((ht|f)tps?:\/\/)?[\w-]+(\.[\w-]+)+:\d{1,5}\/$/;return t?T.test(t)?l():l(d):l("\u8BF7\u586B\u5199\u5E73\u53F0\u7F51\u5740")}}]}),P=async()=>{const t=await p.getTableConfigSource(L.value);E.value=t.data.list.map(l=>({...l,PLATLogoUrl:`${l.PLATLogoUrl}?${Math.random()}`})),L.value.total=t.data.total},S=()=>(g.value.resetFields(),g.value.clearValidate(),v.value=!1,D.value="\u65B0\u589E\u5E73\u53F0\u4FE1\u606F",i.terraceInfo={PLATName:"",PLATID:"",description:"",PLATLogoUrl:"",PLATAccessWebsite:"",PLATMappedAddress:""},!0),a=async()=>new Promise((t,l)=>{g.value.validate(async d=>{if(V.value=!1,d)return _.error("\u8BF7\u5B8C\u5584\u5E73\u53F0\u4FE1\u606F"),l();const T=v.value?await p.update({...i.terraceInfo,PLATID:i.terraceInfo.id}):await p.create(i.terraceInfo);return T.code!==0?(_.error(T.reason),l()):(S(),P(),t(!0))})}),R=t=>{L.value.current=t,P()},j=t=>{s.value=!0,v.value=!0,D.value="\u66F4\u65B0\u5E73\u53F0\u4FE1\u606F",i.terraceInfo=JSON.parse(JSON.stringify(t)),r.value.url=i.terraceInfo.PLATLogoUrl},x=async t=>{h.value=t,C.value=!0;const l=await p.getSiteByAppID(t.id);p.getRoleByAppID(t.id).then(d=>{A.value=d.data.map(({id:T})=>T)}),l.code===0&&(m.value=l.data.list.map(({id:d})=>d))},ee=(t,l)=>{const{onProgress:d,onError:T,onSuccess:qe,fileItem:H,name:Ge}=t,B=new FormData;B.append("fileName",l.PLATCode),B.append("photoType",ye),B.append("file",H.file),console.log(B),ie.upload(B);const K=new FileReader;K.readAsDataURL(H.file),K.onload=function(ue){i.terraceInfo.PLATLogoUrl=ue.target.result}},ae=async t=>{const l=await p.delete(t.id);l.code===0?(P(),_.success("\u8BF7\u6C42\u6210\u529F")):_.success(l.reason)},te=async()=>{const t=await p.getSiteByAppID(1);f.value=t.data.list};(async()=>{const t=await p.getRoleByAppID(1);I.value=t.data,console.log(I)})();const oe=async()=>{(b.value==="site"?await p.setSiteIntoTerrace({id:h.value.id,siteIDs:m.value.map(l=>l.toString())}):await p.setRoleIntoTerrace({id:h.value.id,roleIDs:A.value.map(l=>l.toString())})).code===0&&(C.value=!1,_.success("\u8BF7\u6C42\u6210\u529F"))},ne=()=>{m.value=[],A.value=[],C.value=!1},le=(t,l)=>{r.value={...l}},se=t=>{r.value=t};return P(),te(),{columns:e,visible:s,title:D,isEdit:v,drawerVisible:C,checkeds:m,checkedsRole:A,defaultChecked:J,dataSource:E,formRef:g,rules:U,sites:f,roles:I,loading:V,tableConfig:L,viewTab:b,file:r,describe:k,filterSites:W,isAllChecked:q,...ce(i),reloadAsyncComponent:S,handleGetComponentSubmit:a,handleChangePage:R,handleUpdateTerrace:j,handleUpdateTerraceSites:x,handleDeleteTerrace:ae,handleOk:oe,handleCancel:ne,handleAllChecked:M,customRequest:ee,onProgress:se,onChange:le}}}),Ve={class:"terrace-management-wrap container"},Ne={key:0,class:"arco-upload-list-picture custom-upload-avatar"},Ue=["src"],Se={class:"arco-upload-list-picture-mask"},Re={key:1,class:"arco-upload-picture-card"},$e={class:"arco-upload-picture-card-text"},Oe=y("div",{style:{"margin-top":"10px","font-weight":"600"}},"\u4E0A\u4F20",-1);function Me(e,s,D,C,J,m){const A=pe,h=me,E=$("icon-settings"),g=fe,V=$("icon-delete"),v=Ae,f=ge,I=Fe,b=ve,r=Be,i=$("IconEdit"),L=$("IconPlus"),k=be,M=Te,W=Le,q=Ee,N=Pe,G=_e,U=we,P=Ce,S=he;return F(),w("div",Ve,[o(I,{style:{width:"100%"},title:"\u5E73\u53F0\u7BA1\u7406"},{extra:n(()=>[o(A,{onClick:s[0]||(s[0]=a=>e.visible=!0)},{default:n(()=>[c("\u65B0\u589E")]),_:1})]),default:n(()=>[o(f,{data:e.dataSource,pagination:e.tableConfig,columns:e.columns,onPageChange:e.handleChangePage},{PLATAccessWebsite:n(({record:a})=>[o(A,{href:a.PLATAccessWebsite,target:"_black"},{default:n(()=>[c(O(a.PLATAccessWebsite),1)]),_:2},1032,["href"])]),PLATMappedAddress:n(({record:a})=>[o(A,{href:a.PLATMappedAddress,target:"_black"},{default:n(()=>[c(O(a.PLATMappedAddress),1)]),_:2},1032,["href"])]),PLATLogoUrl:n(({record:a})=>[o(h,{width:"60px",src:a.PLATLogoUrl},null,8,["src"])]),Optional:n(({record:a})=>[o(v,null,{default:n(()=>[o(g,{type:"outline",size:"mini",onClick:R=>e.handleUpdateTerraceSites(a)},{icon:n(()=>[o(E)]),default:n(()=>[c(" \u8BBE\u7F6E ")]),_:2},1032,["onClick"]),o(g,{type:"primary",size:"mini",onClick:R=>e.handleUpdateTerrace(a)},{icon:n(()=>[o(E)]),default:n(()=>[c(" \u66F4\u65B0 ")]),_:2},1032,["onClick"]),o(g,{type:"primary",status:"danger",size:"mini",onClick:R=>e.handleDeleteTerrace(a)},{icon:n(()=>[o(V)]),default:n(()=>[c(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","pagination","columns","onPageChange"])]),_:1}),o(q,{visible:e.visible,"onUpdate:visible":s[5]||(s[5]=a=>e.visible=a),"modal-class":"async-modal-wrap",title:e.title,"title-align":"start","ok-loading":e.loading,"unmount-on-close":!0,"mask-closable":!1,"on-before-cancel":e.reloadAsyncComponent,"on-before-ok":e.reloadAsyncComponent,onBeforeOk:e.handleGetComponentSubmit},{default:n(()=>[o(W,{ref:"formRef",model:e.terraceInfo,rules:e.rules,layout:"vertical"},{default:n(()=>[o(r,{label:"\u540D\u79F0",prop:"PLATName",field:"PLATName"},{default:n(()=>[o(b,{modelValue:e.terraceInfo.PLATName,"onUpdate:modelValue":s[1]||(s[1]=a=>e.terraceInfo.PLATName=a),placeholder:"\u8BF7\u8F93\u5165\u5E73\u53F0\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(r,{label:"\u5E73\u53F0\u95E8\u6237\u7F51\u5740"},{default:n(()=>[o(b,{modelValue:e.terraceInfo.PLATAccessWebsite,"onUpdate:modelValue":s[2]||(s[2]=a=>e.terraceInfo.PLATAccessWebsite=a)},null,8,["modelValue"])]),_:1}),o(r,{label:"\u5E73\u53F0\u6620\u5C04\u7F51\u5740"},{default:n(()=>[o(b,{modelValue:e.terraceInfo.PLATMappedAddress,"onUpdate:modelValue":s[3]||(s[3]=a=>e.terraceInfo.PLATMappedAddress=a)},null,8,["modelValue"])]),_:1}),e.isEdit?(F(),z(r,{key:0,label:"Logo"},{default:n(()=>[o(k,{action:"/","file-list":e.file?[e.file]:[],"show-file-list":!1,"custom-request":a=>{e.customRequest(a,e.terraceInfo)},onChange:e.onChange,onProgress:e.onProgress},{"upload-button":n(()=>[y("div",{class:Ie(`arco-upload-list-item${e.file&&e.file.status==="error"?" arco-upload-list-item-error":""}`)},[e.file&&e.file.url?(F(),w("div",Ne,[y("img",{src:e.file.url},null,8,Ue),y("div",Se,[o(i)])])):(F(),w("div",Re,[y("div",$e,[o(L),Oe])]))],2)]),_:1},8,["file-list","custom-request","onChange","onProgress"])]),_:1})):ke("",!0),o(r,{label:"\u63CF\u8FF0"},{default:n(()=>[o(M,{modelValue:e.terraceInfo.description,"onUpdate:modelValue":s[4]||(s[4]=a=>e.terraceInfo.description=a),placeholder:"\u8BF7\u8F93\u5165\u5E73\u53F0\u63CF\u8FF0\u4FE1\u606F","max-length":200,"allow-clear":"","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title","ok-loading","on-before-cancel","on-before-ok","onBeforeOk"]),o(S,{width:340,visible:e.drawerVisible,"unmount-on-close":"",onOk:e.handleOk,onCancel:e.handleCancel},{title:n(()=>[c(" \u6570\u636E\u7ED1\u5B9A")]),default:n(()=>[o(P,{modelValue:e.viewTab,"onUpdate:modelValue":s[10]||(s[10]=a=>e.viewTab=a),position:"right",onChange:s[11]||(s[11]=a=>{e.viewTab=a})},{default:n(()=>[o(U,{key:"site",title:"\u98DE\u884C\u5E73\u53F0"},{default:n(()=>[o(v,{direction:"vertical"},{default:n(()=>[o(b,{modelValue:e.describe,"onUpdate:modelValue":s[6]||(s[6]=a=>e.describe=a),placeholder:"\u8BF7\u8F93\u5165\u7AD9\u70B9\u540D\u79F0"},null,8,["modelValue"]),o(N,{modelValue:e.isAllChecked,"onUpdate:modelValue":s[7]||(s[7]=a=>e.isAllChecked=a),onChange:e.handleAllChecked},{default:n(()=>[c(" \u5168\u9009 ")]),_:1},8,["modelValue","onChange"])]),_:1}),o(G,{modelValue:e.checkeds,"onUpdate:modelValue":s[8]||(s[8]=a=>e.checkeds=a),direction:"vertical"},{default:n(()=>[(F(!0),w(Q,null,X(e.filterSites,a=>(F(),z(N,{key:a.id,value:a.id,label:a.siteName},{default:n(()=>[c(O(a.siteName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(U,{key:"role",title:"\u89D2\u8272\u6743\u9650"},{default:n(()=>[o(G,{modelValue:e.checkedsRole,"onUpdate:modelValue":s[9]||(s[9]=a=>e.checkedsRole=a),direction:"vertical"},{default:n(()=>[(F(!0),w(Q,null,X(e.roles,a=>(F(),z(N,{key:a.id,value:a.id,label:a.roleName},{default:n(()=>[c(O(a.roleName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["visible","onOk","onCancel"])])}const ma=re(De,[["render",Me]]);export{ma as default};
